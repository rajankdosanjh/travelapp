{% extends "base.html" %}
{% block title %}Reviews â€“ UrbanTrail{% endblock %}

{% block head %}
<style>
    .review-card {
        border-radius: 1rem;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        box-shadow: 0 10px 22px rgba(0,0,0,.05);
        padding: 1rem 1.2rem;
        margin-bottom: 1rem;
    }

    .sentiment-chip {
        border-radius: 999px;
        padding: .25rem .7rem;
        font-size: .75rem;
        display: inline-flex;
        align-items: center;
        gap: .3rem;
    }

    .sentiment-positive {
        background: rgba(34,197,94,.15);
        color: #15803d;
    }

    .sentiment-neutral {
        background: rgba(234,179,8,.18);
        color: #854d0e;
    }

    .sentiment-negative {
        background: rgba(239,68,68,.15);
        color: #b91c1c;
    }
</style>
{% endblock %}

{% block content %}
<h2 class="h4 fw-bold mb-2">Reviews for {{ location.name }}</h2>
<p class="text-muted small mb-4">
    Average sentiment {{ avg_sentiment | round(2) }}
</p>

<div class="card app-card mb-4">
    <div class="card-body">
        <h3 class="h6 fw-semibold mb-2">Community feedback</h3>
        {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('add_location_feedback', location_id=location.id) }}">
            <div class="row g-2 align-items-center">
                <div class="col-md-9">
                    <input type="text" name="body" class="form-control form-control-sm" placeholder="Add a short comment" required>
                </div>
                <div class="col-md-3 d-grid">
                    <button class="btn btn-primary btn-sm" type="submit">Post</button>
                </div>
            </div>
            <div class="text-muted small mt-2">Sentiment score is computed automatically from your comment.</div>
        </form>
        {% else %}
        <p class="text-muted small mb-0">Sign in to rate and comment on this location.</p>
        {% endif %}
    </div>
</div>

{% if feedbacks %}
<div class="mb-4">
    {% for feedback in feedbacks %}
    <div class="review-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>@{{ feedback.user.username }}</strong>
            {% if feedback.rating > 0.4 %}
                <span class="sentiment-chip sentiment-positive">
                    <i class="bi bi-emoji-smile"></i>
                    {{ feedback.rating | round(2) }}
                </span>
            {% elif feedback.rating > -0.4 %}
                <span class="sentiment-chip sentiment-neutral">
                    <i class="bi bi-emoji-neutral"></i>
                    {{ feedback.rating | round(2) }}
                </span>
            {% else %}
                <span class="sentiment-chip sentiment-negative">
                    <i class="bi bi-emoji-frown"></i>
                    {{ feedback.rating | round(2) }}
                </span>
            {% endif %}
        </div>
            <p class="mb-0">{{ feedback.body }}</p>
        </div>
    {% endfor %}
</div>
{% else %}
<p class="text-muted fst-italic">No community feedback yet. Be the first to add one.</p>
{% endif %}

{% if reviews %}
    {% for review in reviews %}
    <div class="review-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>@{{ review.username }}</strong>

            {% if review.sentiment > 0.4 %}
                <span class="sentiment-chip sentiment-positive">
                    <i class="bi bi-emoji-smile"></i>
                    {{ review.sentiment | round(2) }}
                </span>
            {% elif review.sentiment > -0.4 %}
                <span class="sentiment-chip sentiment-neutral">
                    <i class="bi bi-emoji-neutral"></i>
                    {{ review.sentiment | round(2) }}
                </span>
            {% else %}
                <span class="sentiment-chip sentiment-negative">
                    <i class="bi bi-emoji-frown"></i>
                    {{ review.sentiment | round(2) }}
                </span>
            {% endif %}
        </div>

        <p class="mb-0">{{ review.text }}</p>
    </div>
    {% endfor %}
{% else %}
    <p class="text-muted fst-italic">No reviews yet for this location.</p>
{% endif %}
{% endblock %}
